"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[32639],{35318:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var r=a(27378);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),p=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(a),h=n,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||i;return a?r.createElement(m,o(o({ref:t},c),{},{components:a})):r.createElement(m,o({ref:t},c))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,o[1]=s;for(var p=2;p<i;p++)o[p]=a[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},48820:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=a(25773),n=(a(27378),a(35318));const i={title:"Secure your API with these 16 Practices with Apache APISIX - part 2",authors:[{name:"Nicolas Fr\xe4nkel",title:"Author",url:"https://github.com/nfrankel",image_url:"https://avatars.githubusercontent.com/u/752258"}],keywords:["APISIX","Security","Good practices"],description:"A couple of months ago, I stumbled upon this list of  Secure your API with these 16 practices to secure your API. Authentication. Authorization. Data Redaction. Encryption. Error Handling. Input Validation & Data Sanitization. Intrusion Detection Systems. IP Whitelisting. Logging and Monitoring. Rate Limiting. Secure Dependencies. Security Headers. Token Expiry. Use of Security Standards and Frameworks. Web Application Firewall. API Versioning\n",tags:["Ecosystem"],image:"https://static.apiseven.com/uploads/2024/02/15/kgIjhRXf_img-BuLDzx81CexYQAzkaF36h_large.webp"},o=void 0,s={permalink:"/blog/2024/02/27/secure-api-practices-apisix-2",source:"@site/blog/2024/02/27/secure-api-practices-apisix-2.md",title:"Secure your API with these 16 Practices with Apache APISIX - part 2",description:"A couple of months ago, I stumbled upon this list of  Secure your API with these 16 practices to secure your API. Authentication. Authorization. Data Redaction. Encryption. Error Handling. Input Validation & Data Sanitization. Intrusion Detection Systems. IP Whitelisting. Logging and Monitoring. Rate Limiting. Secure Dependencies. Security Headers. Token Expiry. Use of Security Standards and Frameworks. Web Application Firewall. API Versioning\n",date:"2024-02-27T00:00:00.000Z",formattedDate:"February 27, 2024",tags:[{label:"Ecosystem",permalink:"/blog/tags/ecosystem"}],readingTime:3.63,truncated:!0,authors:[{name:"Nicolas Fr\xe4nkel",title:"Author",url:"https://github.com/nfrankel",image_url:"https://avatars.githubusercontent.com/u/752258",imageURL:"https://avatars.githubusercontent.com/u/752258"}],prevItem:{title:"Monthly Report (January 29 - February 29)",permalink:"/blog/2024/03/05/monthly-report"},nextItem:{title:"Secure your API with these 16 Practices with Apache APISIX - part 1",permalink:"/blog/2024/02/20/secure-api-practices-apisix-1"}},l={authorsImageUrls:[void 0]},p=[{value:"Encryption and Data Redaction",id:"encryption-and-data-redaction",children:[],level:2},{value:"Error Handling",id:"error-handling",children:[],level:2},{value:"Security Headers",id:"security-headers",children:[],level:2},{value:"WAF and API versioning",id:"waf-and-api-versioning",children:[],level:2},{value:"Other items",id:"other-items",children:[],level:2},{value:"Conclusion",id:"conclusion",children:[],level:2}],c={toc:p};function u(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("head",null,(0,n.kt)("link",{rel:"canonical",href:"https://blog.frankel.ch/secure-api-practices-apisix/2/"})),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},(0,n.kt)("a",{parentName:"p",href:"https://blog.frankel.ch/secure-api-practices-apisix/1/"},"Last week"),", we listed 16 practices to help secure one's APIs and described how to implement them with Apache APISIX."),(0,n.kt)("ol",{parentName:"blockquote"},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("del",{parentName:"li"},"Authentication \ud83d\udd75\ufe0f\ufe0f - Verifies the identity of users accessing APIs.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("del",{parentName:"li"},"Authorization \ud83d\udea6 - Determines permissions of authenticated users.")),(0,n.kt)("li",{parentName:"ol"},"Data Redaction \ud83d\udd8d\ufe0f - Obscures sensitive data for protection."),(0,n.kt)("li",{parentName:"ol"},"Encryption \ud83d\udd12 - Encodes data so only authorized parties can decode it."),(0,n.kt)("li",{parentName:"ol"},"Error Handling \u274c - Manages responses when things go wrong, avoiding revealing sensitive info."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("del",{parentName:"li"},"Input Validation & Data Sanitization \ud83e\uddf9 - Checks input data and removes harmful parts.")),(0,n.kt)("li",{parentName:"ol"},"Intrusion Detection Systems \ud83d\udc40 - Monitor networks for suspicious activities."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("del",{parentName:"li"},"IP Whitelisting \ud83d\udcdd - Permits API access only from trusted IP addresses.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("del",{parentName:"li"},"Logging and Monitoring \ud83d\udda5\ufe0f - Keeps detailed logs and regularly monitors APIs.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("del",{parentName:"li"},"Rate Limiting \u23f1\ufe0f - Limits user requests to prevent overload.")),(0,n.kt)("li",{parentName:"ol"},"Secure Dependencies \ud83d\udce6 - Ensures third-party code is free from vulnerabilities."),(0,n.kt)("li",{parentName:"ol"},"Security Headers \ud83d\udccb - Enhances site security against types of attacks like XSS."),(0,n.kt)("li",{parentName:"ol"},"Token Expiry \u23f3 - Regularly expiring and renewing tokens prevents unauthorized access."),(0,n.kt)("li",{parentName:"ol"},"Use of Security Standards and Frameworks \ud83d\udcd8 - Guides your API security strategy."),(0,n.kt)("li",{parentName:"ol"},"Web Application Firewall \ud83d\udd25 - Protects your site from HTTP-specific attacks."),(0,n.kt)("li",{parentName:"ol"},"API Versioning \ud83d\udd04 - Maintains different versions of your API for seamless updates.")),(0,n.kt)("p",{parentName:"blockquote"},"This week, we will look at the remaining practices.")),(0,n.kt)("h2",{id:"encryption-and-data-redaction"},"Encryption and Data Redaction"),(0,n.kt)("p",null,"First, we must protect the communication channel between our APIs and clients from unwanted reads and writes. That's the realm of TLS. In this regard, mutual TLS is state-of-the-art. Please read this ",(0,n.kt)("a",{parentName:"p",href:"https://blog.frankel.ch/mtls-everywhere/"},"previous post")," about mTLS in Apache APISIX."),(0,n.kt)("p",null,"I can't guess what the author meant by \"Obscures sensitive data for protection\". If data exchanges are encrypted, it doesn't make sense to obfuscate any payload."),(0,n.kt)("h2",{id:"error-handling"},"Error Handling"),(0,n.kt)("p",null,"The list mentions avoiding revealing sensitive info when an error happens. Indeed, some poorly coded upstreams can disclose such data. Here's an example of Tomcat when developers forgot to configure an error page:"),(0,n.kt)("p",null,"It reveals the upstream's technology, version, and the guilty code."),(0,n.kt)("p",null,"Apache APISIX can intercept such a response and rewrite it:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'routes:\n  - upstream_id: 1\n    plugins:\n      response-rewrite:\n        vars: [[ "status","==",500 ]]                        #1\n        body: { "error" : "An unknown exception happened"}   #2\n')),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Triggered only in case of HTTP status code 500 returned by the upstream. You can add additional status codes if necessary"),(0,n.kt)("li",{parentName:"ol"},"The body to return")),(0,n.kt)("p",null,"To make sure the above configuration is applied consistently, we can also make it a global rule:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'global_rules:\n  - id: 1\n    plugins:\n      response-rewrite:\n        vars: [[ "status","==",500 ]]\n        body: { "error" : "An unknown exception happened"}\n')),(0,n.kt)("h2",{id:"security-headers"},"Security Headers"),(0,n.kt)("p",null,"The OWASP lists plenty of ",(0,n.kt)("a",{parentName:"p",href:"https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html"},"HTTP Headers")," you can set to improve the security of your web apps and APIs. Apache APISIX provides two dedicated plugins for specific security risks:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://apisix.apache.org/docs/apisix/plugins/cors/"},"CORS")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://apisix.apache.org/docs/apisix/plugins/csrf/"},"CSRF"))),(0,n.kt)("p",null,"For any other header, you can use the more generic ",(0,n.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/apisix/plugins/response-rewrite/"},"response-rewrite")," plugin to add them. Finally, we can remove default HTTP response headers, such as ",(0,n.kt)("inlineCode",{parentName:"p"},"Server"),", to make targeted attacks less likely."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"global_rules:                               #1\n  - id: 1\n    plugins:\n      response-rewrite:\n        headers:\n          set:\n            X-Content-Type-Options: nosniff #2\n          remove:\n            - Server                        #3\n")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Do on every route - security by default! It still can be overridden on a per-route basis, in case of need"),(0,n.kt)("li",{parentName:"ol"},"Tell the browser not to infer the content type if it's not explicitly set"),(0,n.kt)("li",{parentName:"ol"},"Don't advertise the server")),(0,n.kt)("h2",{id:"waf-and-api-versioning"},"WAF and API versioning"),(0,n.kt)("p",null,"I've addressed these two points in previous posts:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://blog.frankel.ch/apisix-owasp-coraza-core-ruleset/"},"Hardening Apache APISIX with the OWASP's Coraza and Core Ruleset")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://blog.frankel.ch/api-versioning/"},"API Versioning"))),(0,n.kt)("p",null,"In short, Apache APSIX allows embedding the ",(0,n.kt)("a",{parentName:"p",href:"https://coraza.io/"},"Coraza WAF")," as a Rust plugin."),(0,n.kt)("p",null,"On the versioning side, one can choose three different approaches: path-based, query parameter-based, and header-based. APISIX supports all of them."),(0,n.kt)("h2",{id:"other-items"},"Other items"),(0,n.kt)("p",null,"The remaining items are:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Intrusion Detection Systems"),(0,n.kt)("li",{parentName:"ul"},"Secure Dependencies"),(0,n.kt)("li",{parentName:"ul"},"Use of Security Standards and Frameworks")),(0,n.kt)("p",null,"I'm afraid that APISIX cannot help with any of them. You need to address them on the upstream side."),(0,n.kt)("h2",{id:"conclusion"},"Conclusion"),(0,n.kt)("p",null,"In this two-post series, I've addressed most of the 16 practices to secure APIs with Apache APISIX. While I don't claim the list is exhaustive, it's a solid basis to improve the security of one's system."))}u.isMDXComponent=!0}}]);